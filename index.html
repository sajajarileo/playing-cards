<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Playing Cards</title>
  <link rel="icon" href="https://lh3.googleusercontent.com/pw/AP1GczPG_etOLYxP08IcrCm7HFSqSBTlMB2SIfQoz6NufxOjXjJMKFB7lng5M5ZI3-bdtbQvLLWgJQLQ7IkQjiID72BuWAuPDYiTsr9tnmqAifYdUGQSd6aXYFpIvOqs0VLDERSB7VlBNAdPsbQfRSTrLMs=w923-h923-s-no-gm?authuser=0">
  <style>
    body {background-color: crimson;}
    
    [class*='card'] {
      --rotate: 0;
      --rotateX: 0;
      --width: 120px;
      --content: '';
      
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%) rotate(var(--rotate)) rotateX(var(--rotateX));
      transform-style: preserve-3d;
      transition: left 1s, top 1s, transform 1s;

      width: var(--width); height: calc(var(--width) / 63 * 88);
      border-radius: 8%;
      background-color: #fff;
      color: #000;

      cursor: pointer;
    }
    
    #card-top {
      transition: none;
      border-right: solid 16px #ddd;
      border-bottom: solid 12px #bbb;
      box-shadow: 2px 2px 4px #0008;
      z-index: 1;
    }
    
    .flop {--rotateX: 180deg; transition: left 1s, top 1s, transform 1s!important; pointer-events: none; animation: none;}
    
    [class*='card']::after, [class*='card']::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      padding: 6%;
      border-radius: inherit;
      box-sizing: border-box;
      background: repeating-linear-gradient(60deg, #fff6 0%, #fff6 2%, transparent 2%, transparent 8%), repeating-linear-gradient(-60deg, #fff6 0%, #fff6 2%, transparent 2%, transparent 8%), #000 content-box;
      color: inherit;
      backface-visibility: hidden;
      white-space: pre;
    }

    [class*='card']::after {
      content: var(--content);
      transform: rotateX(180deg);
      padding: 8%;
      background: #fff;

      display: flex;
      justify-content: flex-start;

      font-size: 1.25em;
      font-weight: bold;
      line-height: 1.4;
      text-align: center;
      box-shadow: 2px 2px 4px #0008;
    }

    [class*='card'].joker::after,
    [class*='card'].red_joker::after {
      content: 'J\A O\A K\A E\A R';
      background: #000 url(https://lh3.googleusercontent.com/pw/AP1GczPG_etOLYxP08IcrCm7HFSqSBTlMB2SIfQoz6NufxOjXjJMKFB7lng5M5ZI3-bdtbQvLLWgJQLQ7IkQjiID72BuWAuPDYiTsr9tnmqAifYdUGQSd6aXYFpIvOqs0VLDERSB7VlBNAdPsbQfRSTrLMs=w923-h923-s-no-gm?authuser=0) 1.3em center / calc(100% - 1.5em) no-repeat;
      color: #fff;
      align-items: center;
    }
    [class*='card'].red_joker::after {
      background-color: hsl(0, 100%, 20%);
      background-blend-mode: lighten;
    }

    #card-top:not(.dealing):not([style*='pointer-events: none'])::after {
      content: 'Click!';
      position: absolute;
      left: 50%; transform: translate(-50%, -100%);
      width: 80%; height: auto;
      padding: 0 0 12%;
      aspect-ratio: 3 / 2;
      border-radius: 0;
      background-color: #fff;
      clip-path: polygon(0% 0%, 100% 0%, 100% 80%, 65% 80%, 50% 100%, 35% 80%, 0% 80%);
      color: crimson;
      justify-content: center; align-items: center;
      z-index: -1;
      cursor: default;
      animation: card-top-after 1s ease infinite alternate;
    }
    
    @keyframes card-top-after {
      from {top: -8px;}
      to {top: -16px;}
    }
    
    #card-top.dealing,
    #card-top.dealing ~ * {
      --rotate: 360deg;
    }

    #card-top.dealing {transition: transform 2.4s, opacity 1s;}
    #card-top.running-out.dealing,
    #card-top.running-out[style*='pointer-events: none'] {opacity: 0.6;}
    
    .dealing ~ .card-hand {
    &:nth-of-type(-n + 3) {top: 20%;}
    &:nth-last-of-type(-n + 3) {top: 80%;}
    &:nth-of-type(even):not(:last-of-type) {left: 20%;}
    &:nth-of-type(odd):not(:first-of-type) {left: 80%;}

    &:nth-of-type(7) {transition: left 1s 0.2s, top 1s 0.2s, transform 2.4s;}
    &:nth-of-type(8) {transition: left 1s 0.4s, top 1s 0.4s, transform 2.4s;}
    &:nth-of-type(6) {transition: left 1s 0.6s, top 1s 0.6s, transform 2.4s;}
    &:nth-of-type(4) {transition: left 1s 0.8s, top 1s 0.8s, transform 2.4s;}
    &:nth-of-type(2) {transition: left 1s 1s, top 1s 1s, transform 2.4s;}
    &:nth-of-type(1) {transition: left 1s 1.2s, top 1s 1.4s, transform 2.4s;}
    &:nth-of-type(3) {transition: left 1s 1.4s, top 1s 1.4s, transform 2.4s;}
    
    &::before {animation: outer-glow 0.6s ease-in infinite alternate;}
    }
    
    @keyframes outer-glow {
      from {box-shadow: 0 0 16px 2px #fff;}
      to {box-shadow: 0 0 4px 2px #fff4;}
    }

    @media (max-width: 480px) {
      body {font-size: 0.85em;}
      [class*='card'] {--width: 100px;}
      #card-top:not(.dealing):not([style*='pointer-events: none'])::after {width: 88%;}
    }
    
    @media (max-width: 400px) {
      body {font-size: 0.70em;}
      [class*='card'] {--width: 80px;}
      #card-top:not(.dealing):not([style*='pointer-events: none'])::after {width: 100%;}
    }
  </style>
</head>
<body>
  <section>
    <i id="card-top" class="card"></i>
    <div class="card-hand"></div>
    <div class="card-hand"></div>
    <div class="card-hand"></div>
    <div class="card-hand"></div>
    <div class="card-hand"></div>
    <div class="card-hand"></div>
    <div class="card-hand"></div>
    <div class="card-hand"></div>
  </section>

  <script>
    let deck;

    const I_CARDTOP = document.getElementById('card-top');
    const C_CARDHAND = document.querySelectorAll('.card-hand');

    function shuffle(){
      deck = Array(14).fill('ffff');
      deck[deck.length - 1] = 'ff'
      C_CARDHAND.forEach(e => e.style.visibility = 'visible');
    } shuffle();

    function cardLeft(){
      let result = (deck.join('').match(/f/g) || []).length;
      return result;
    } cardLeft();

    I_CARDTOP.addEventListener('click', function(){
      this.classList.toggle('dealing');
      this.style.pointerEvents = 'none'
      C_CARDHAND.forEach(e => e.classList.remove('flop'));
      
      if (cardLeft() < C_CARDHAND.length && this.classList.contains('dealing')) {
        if (cardLeft() === 0) {
          shuffle();
          this.classList.remove('running-out');
          return;
        }
        this.classList.add('running-out');
        for (let i = 0; i < C_CARDHAND.length - cardLeft(); i++) {
          C_CARDHAND[i].style.visibility = 'hidden';
        }
      }
    });

    C_CARDHAND[2].addEventListener('transitionend', () => {
      I_CARDTOP.style.pointerEvents = 'auto'
    });

    C_CARDHAND.forEach(e => e.addEventListener('click', function(){
      let cardNum;
      let cardSuit;
      let cardColor;
      let symbol = ['♠', '♥', '◆', '♣'];
      if (this.classList.contains('flop') ||
      !I_CARDTOP.classList.contains('dealing')) return;

      for (;;) {
        // if (deck.every(e => /^t+$/.test(e))) shuffle();
        cardNum = Math.floor(Math.random() * 14);
        cardSuit = Math.floor(Math.random() * 4);
        if (cardNum === deck.length - 1)
        cardSuit < 2 ? cardSuit = 0 : cardSuit = 1;

        if (deck[cardNum][cardSuit] === 'f') {
          let count = deck[cardNum].split('');
          count[cardSuit] = 't';
          deck[cardNum] = count.join('');

          this.classList.add('flop');
          this.classList.remove('joker');
          this.classList.remove('red_joker');

          if (cardNum === deck.length - 1) {
            cardSuit === 0 ? this.classList.add('joker') : this.classList.add('red_joker');
          } else {
            if (cardNum === 0) cardNum = 'A';
            else if (cardNum === 10) cardNum = 'J';
            else if (cardNum === 11) cardNum = 'Q';
            else if (cardNum === 12) cardNum = 'K';
            else cardNum++;
            cardSuit === 0 || cardSuit === 3 ? cardColor = 'black' : cardColor = 'red';
            this.style.setProperty('--content', `'${cardNum}\\A ${symbol[cardSuit]}'`);
            this.style.color = cardColor;
          }
          break;
        }
      }
    }));
  </script>
</body>
</html>